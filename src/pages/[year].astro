---
/**
 * Claude Code 年別ページ
 * getStaticPaths で年一覧を生成し、ChangelogPage で表示
 */
import { readdirSync } from 'node:fs';
import { join } from 'node:path';
import ChangelogPage from '../components/ChangelogPage.astro';

export function getStaticPaths() {
  // content/ ディレクトリから年を自動検出
  const contentDir = join(process.cwd(), 'content');
  const files = readdirSync(contentDir);
  const years = files
    .filter((f) => /^CHANGELOG_(\d{4})_JA\.md$/.test(f))
    .map((f) => f.match(/^CHANGELOG_(\d{4})_JA\.md$/)![1])
    .sort()
    .reverse();

  return years.map((year) => ({
    params: { year },
    props: { year, years },
  }));
}

interface Props {
  year: string;
  years: string[];
}

const { year, years } = Astro.props;

// 動的にJSONをインポート
const changelogData = await import(`../data/changelog-${year}.json`);
const { months, generatedAt } = changelogData;
---

<ChangelogPage
  year={year}
  years={years}
  months={months}
  generatedAt={generatedAt}
  product="claude-code"
/>
