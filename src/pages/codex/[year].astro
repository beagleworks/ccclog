---
/**
 * Codex 年別ページ
 * getStaticPaths で年一覧を生成し、ChangelogPage で表示
 */
import { readdirSync } from 'node:fs';
import { join } from 'node:path';
import ChangelogPage from '../../components/ChangelogPage.astro';

export function getStaticPaths() {
  // content/codex/ ディレクトリから年を自動検出
  const contentDir = join(process.cwd(), 'content', 'codex');

  try {
    const files = readdirSync(contentDir);
    const years = files
      .filter((f) => /^CHANGELOG_(\d{4})_JA\.md$/.test(f))
      .map((f) => f.match(/^CHANGELOG_(\d{4})_JA\.md$/)![1])
      .sort()
      .reverse();

    return years.map((year) => ({
      params: { year },
      props: { year, years },
    }));
  } catch {
    // ディレクトリが存在しない場合は空配列を返す
    return [];
  }
}

interface Props {
  year: string;
  years: string[];
}

const { year, years } = Astro.props;

// Codex用のJSONを動的にインポート
const changelogData = await import(`../../data/codex/changelog-${year}.json`);
const { months, generatedAt } = changelogData;
---

<ChangelogPage
  year={year}
  years={years}
  months={months}
  generatedAt={generatedAt}
  product="codex"
/>
