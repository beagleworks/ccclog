---
/**
 * Claude Code トップページ
 * 最新年のコンテンツを直接表示（リダイレクトなし）
 */
import ChangelogPage from '../components/ChangelogPage.astro';
import BaseLayout from '../layouts/BaseLayout.astro';
import { listChangelogYears } from '../lib/server/changelog-years';

// content/ ディレクトリから年を自動検出
const years = listChangelogYears('claude-code');

// 最新年のデータを取得
const latestYear = years[0];
let months: any[] = [];
let generatedAt = new Date().toISOString();

if (latestYear) {
  try {
    const changelogData = await import(`../data/changelog-${latestYear}.json`);
    months = changelogData.months;
    generatedAt = changelogData.generatedAt;
  } catch {
    // データが存在しない場合は空配列のまま
  }
}
---

{years.length > 0 && months.length > 0 ? (
  <ChangelogPage
    year={latestYear}
    years={years}
    months={months}
    generatedAt={generatedAt}
    product="claude-code"
  />
) : (
  <BaseLayout title="Claude Code CHANGELOG Viewer" years={[]} product="claude-code">
    <div class="no-data">
      <p>データがありません。</p>
    </div>
  </BaseLayout>
)}

<style>
  .no-data {
    text-align: center;
    padding: 3rem 1rem;
    color: var(--color-text-muted);
  }
</style>
